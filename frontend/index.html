<!DOCTYPE html>
<html>
<head>
    <title>Loan Management System</title>
    <style>
        body { font-family: Arial; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #333; margin-bottom: 30px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; }
        .section h2 { color: #007bff; margin-top: 0; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background: #0056b3; }
        input, select { padding: 8px; margin: 5px; width: 200px; border: 1px solid #ddd; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; background: white; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #007bff; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .success { color: green; background: #d4edda; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .error { color: red; background: #f8d7da; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .form-row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin: 10px 0; }
        .loading { color: #007bff; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¶ Loan Management System</h1>
            <p>Complete Backend Framework Implementation</p>
        </div>
        
        <!-- Customer Management -->
        <div class="section">
            <h2>üë§ Customer Management</h2>
            <div class="form-row">
                <input type="text" id="customerName" placeholder="Customer Name" required>
                <input type="email" id="customerEmail" placeholder="Email" required>
                <input type="text" id="customerPhone" placeholder="Phone Number">
                <input type="text" id="customerAddress" placeholder="Address">
                <input type="number" id="customerCredit" placeholder="Credit Score" min="300" max="850">
            </div>
            <div class="form-row">
                <button onclick="createCustomer()">‚ûï Create Customer</button>
                <button onclick="getAllCustomers()">üìã Get All Customers</button>
                <button onclick="clearCustomerForm()">üóëÔ∏è Clear Form</button>
            </div>
            <div id="customerResult"></div>
        </div>

        <!-- Loan Type Management -->
        <div class="section">
            <h2>üìä Loan Type Management</h2>
            <div class="form-row">
                <input type="text" id="loanTypeName" placeholder="Loan Type Name" required>
                <input type="text" id="loanTypeDesc" placeholder="Description">
                <input type="number" id="loanTypeRate" placeholder="Interest Rate %" step="0.1" min="0">
            </div>
            <div class="form-row">
                <button onclick="createLoanType()">‚ûï Create Loan Type</button>
                <button onclick="getAllLoanTypes()">üìã Get All Loan Types</button>
                <button onclick="clearLoanTypeForm()">üóëÔ∏è Clear Form</button>
            </div>
            <div id="loanTypeResult"></div>
        </div>

        <!-- Loan Management -->
        <div class="section">
            <h2>üí∞ Loan Management</h2>
            <div class="form-row">
                <input type="number" id="loanAmount" placeholder="Loan Amount" min="1000" required>
                <input type="number" id="loanRate" placeholder="Interest Rate %" step="0.1" min="0">
                <input type="number" id="loanTenure" placeholder="Tenure (Months)" min="1">
                <select id="loanStatus" required>
                    <option value="">Select Status</option>
                    <option value="PENDING">PENDING</option>
                    <option value="APPROVED">APPROVED</option>
                    <option value="REJECTED">REJECTED</option>
                </select>
            </div>
            <div class="form-row">
                <input type="number" id="loanCustomerId" placeholder="Customer ID" min="1" required>
                <input type="number" id="loanTypeId" placeholder="Loan Type ID" min="1" required>
            </div>
            <div class="form-row">
                <button onclick="createLoan()">‚ûï Create Loan</button>
                <button onclick="getAllLoans()">üìã Get All Loans</button>
                <button onclick="clearLoanForm()">üóëÔ∏è Clear Form</button>
            </div>
            <div id="loanResult"></div>
        </div>

        <!-- Payment Management -->
        <div class="section">
            <h2>üí≥ Payment Management</h2>
            <div class="form-row">
                <input type="number" id="paymentAmount" placeholder="Payment Amount" min="1" required>
                <input type="date" id="paymentDate" required>
                <input type="number" id="paymentLoanId" placeholder="Loan ID" min="1" required>
            </div>
            <div class="form-row">
                <button onclick="createPayment()">‚ûï Create Payment</button>
                <button onclick="getAllPayments()">üìã Get All Payments</button>
                <button onclick="clearPaymentForm()">üóëÔ∏è Clear Form</button>
            </div>
            <div id="paymentResult"></div>
        </div>

        <!-- Search & Filter Functions -->
        <div class="section">
            <h2>üîç Search & Filter</h2>
            <div class="form-row">
                <input type="email" id="searchEmail" placeholder="Search by Email">
                <button onclick="searchByEmail()">üîç Search Customer</button>
            </div>
            <div class="form-row">
                <input type="number" id="searchCredit" placeholder="Min Credit Score" min="300">
                <button onclick="searchByCredit()">üîç Search by Credit</button>
            </div>
            <div class="form-row">
                <select id="searchStatus">
                    <option value="">Select Status</option>
                    <option value="PENDING">PENDING</option>
                    <option value="APPROVED">APPROVED</option>
                    <option value="REJECTED">REJECTED</option>
                </select>
                <button onclick="searchByStatus()">üîç Search Loans</button>
            </div>
            <div class="form-row">
                <input type="number" id="pageNumber" placeholder="Page (0,1,2...)" min="0" value="0">
                <input type="number" id="pageSize" placeholder="Page Size" min="1" max="50" value="5">
                <button onclick="getPaginatedCustomers()">üìÑ Get Paginated Data</button>
            </div>
            <div id="searchResult"></div>
        </div>

        <!-- System Status -->
        <div class="section">
            <h2>‚ö° System Status</h2>
            <div class="form-row">
                <button onclick="testConnection()">üîó Test API Connection</button>
                <button onclick="clearAllResults()">üßπ Clear All Results</button>
            </div>
            <div id="statusResult"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://8080-dabccaecacfcacaabebbcbcbaffbfcca.premiumproject.examly.io/api';

        // Utility Functions
        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<div class="loading">‚è≥ Loading...</div>';
        }

        function showSuccess(elementId, message) {
            document.getElementById(elementId).innerHTML = `<div class="success">‚úÖ ${message}</div>`;
        }

        function showError(elementId, message) {
            document.getElementById(elementId).innerHTML = `<div class="error">‚ùå ${message}</div>`;
        }

        // Customer Functions
        async function createCustomer() {
            const name = document.getElementById('customerName').value;
            const email = document.getElementById('customerEmail').value;
            
            if (!name || !email) {
                showError('customerResult', 'Name and Email are required!');
                return;
            }

            const data = {
                customerName: name,
                email: email,
                phoneNumber: document.getElementById('customerPhone').value,
                address: document.getElementById('customerAddress').value,
                creditScore: parseFloat(document.getElementById('customerCredit').value) || 700
            };
            
            showLoading('customerResult');
            try {
                const response = await fetch(`${API_BASE}/customers`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSuccess('customerResult', `Customer created with ID: ${result.customerId}`);
                    clearCustomerForm();
                } else {
                    showError('customerResult', `Failed to create customer: ${response.status}`);
                }
            } catch (error) {
                showError('customerResult', `Error: ${error.message}`);
            }
        }

        async function getAllCustomers() {
            showLoading('customerResult');
            try {
                const response = await fetch(`${API_BASE}/customers`);
                const customers = await response.json();
                
                if (customers.length === 0) {
                    showSuccess('customerResult', 'No customers found. Create some customers first!');
                    return;
                }

                let html = '<h3>üìã All Customers</h3><table><tr><th>ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Address</th><th>Credit Score</th></tr>';
                customers.forEach(customer => {
                    html += `<tr>
                        <td>${customer.customerId}</td>
                        <td>${customer.customerName}</td>
                        <td>${customer.email}</td>
                        <td>${customer.phoneNumber || 'N/A'}</td>
                        <td>${customer.address || 'N/A'}</td>
                        <td>${customer.creditScore}</td>
                    </tr>`;
                });
                html += '</table>';
                document.getElementById('customerResult').innerHTML = html;
            } catch (error) {
                showError('customerResult', `Error: ${error.message}`);
            }
        }

        function clearCustomerForm() {
            document.getElementById('customerName').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('customerCredit').value = '';
        }

        // Loan Type Functions
        async function createLoanType() {
            const typeName = document.getElementById('loanTypeName').value;
            const rate = document.getElementById('loanTypeRate').value;
            
            if (!typeName || !rate) {
                showError('loanTypeResult', 'Type Name and Interest Rate are required!');
                return;
            }

            const data = {
                typeName: typeName,
                description: document.getElementById('loanTypeDesc').value || 'Standard loan type',
                interestRate: parseFloat(rate)
            };
            
            showLoading('loanTypeResult');
            try {
                const response = await fetch(`${API_BASE}/loantypes`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSuccess('loanTypeResult', `Loan Type created with ID: ${result.loanTypeId}`);
                    clearLoanTypeForm();
                } else {
                    showError('loanTypeResult', `Failed to create loan type: ${response.status}`);
                }
            } catch (error) {
                showError('loanTypeResult', `Error: ${error.message}`);
            }
        }

        async function getAllLoanTypes() {
            showLoading('loanTypeResult');
            try {
                const response = await fetch(`${API_BASE}/loantypes`);
                const loanTypes = await response.json();
                
                if (loanTypes.length === 0) {
                    showSuccess('loanTypeResult', 'No loan types found. Create some loan types first!');
                    return;
                }

                let html = '<h3>üìä All Loan Types</h3><table><tr><th>ID</th><th>Type Name</th><th>Description</th><th>Interest Rate</th></tr>';
                loanTypes.forEach(type => {
                    html += `<tr>
                        <td>${type.loanTypeId}</td>
                        <td>${type.typeName}</td>
                        <td>${type.description}</td>
                        <td>${type.interestRate}%</td>
                    </tr>`;
                });
                html += '</table>';
                document.getElementById('loanTypeResult').innerHTML = html;
            } catch (error) {
                showError('loanTypeResult', `Error: ${error.message}`);
            }
        }

        function clearLoanTypeForm() {
            document.getElementById('loanTypeName').value = '';
            document.getElementById('loanTypeDesc').value = '';
            document.getElementById('loanTypeRate').value = '';
        }

        // Loan Functions
        async function createLoan() {
            const amount = document.getElementById('loanAmount').value;
            const customerId = document.getElementById('loanCustomerId').value;
            const loanTypeId = document.getElementById('loanTypeId').value;
            const status = document.getElementById('loanStatus').value;
            
            if (!amount || !customerId || !loanTypeId || !status) {
                showError('loanResult', 'All fields are required for loan creation!');
                return;
            }

            const data = {
                loanAmount: parseFloat(amount),
                interestRate: parseFloat(document.getElementById('loanRate').value) || 7.5,
                tenureMonths: parseInt(document.getElementById('loanTenure').value) || 240,
                status: status,
                customer: { customerId: parseInt(customerId) },
                loanType: { loanTypeId: parseInt(loanTypeId) }
            };
            
            showLoading('loanResult');
            try {
                const response = await fetch(`${API_BASE}/loans`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSuccess('loanResult', `Loan created with ID: ${result.loanId}`);
                    clearLoanForm();
                } else {
                    showError('loanResult', `Failed to create loan: ${response.status}`);
                }
            } catch (error) {
                showError('loanResult', `Error: ${error.message}`);
            }
        }

        async function getAllLoans() {
            showLoading('loanResult');
            try {
                const response = await fetch(`${API_BASE}/loans`);
                const loans = await response.json();
                
                if (loans.length === 0) {
                    showSuccess('loanResult', 'No loans found. Create some loans first!');
                    return;
                }

                let html = '<h3>üí∞ All Loans</h3><table><tr><th>ID</th><th>Amount</th><th>Rate</th><th>Tenure</th><th>Status</th><th>Customer</th><th>Loan Type</th></tr>';
                loans.forEach(loan => {
                    html += `<tr>
                        <td>${loan.loanId}</td>
                        <td>$${loan.loanAmount.toLocaleString()}</td>
                        <td>${loan.interestRate}%</td>
                        <td>${loan.tenureMonths} months</td>
                        <td><span style="color: ${loan.status === 'APPROVED' ? 'green' : loan.status === 'REJECTED' ? 'red' : 'orange'}">${loan.status}</span></td>
                        <td>${loan.customer.customerName}</td>
                        <td>${loan.loanType.typeName}</td>
                    </tr>`;
                });
                html += '</table>';
                document.getElementById('loanResult').innerHTML = html;
            } catch (error) {
                showError('loanResult', `Error: ${error.message}`);
            }
        }

        function clearLoanForm() {
            document.getElementById('loanAmount').value = '';
            document.getElementById('loanRate').value = '';
            document.getElementById('loanTenure').value = '';
            document.getElementById('loanStatus').value = '';
            document.getElementById('loanCustomerId').value = '';
            document.getElementById('loanTypeId').value = '';
        }

        // Payment Functions
        async function createPayment() {
            const amount = document.getElementById('paymentAmount').value;
            const date = document.getElementById('paymentDate').value;
            const loanId = document.getElementById('paymentLoanId').value;
            
            if (!amount || !date || !loanId) {
                showError('paymentResult', 'All fields are required for payment creation!');
                return;
            }

            const data = {
                amount: parseFloat(amount),
                paymentDate: date,
                loan: { loanId: parseInt(loanId) }
            };
            
            showLoading('paymentResult');
            try {
                const response = await fetch(`${API_BASE}/payments`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSuccess('paymentResult', `Payment created with ID: ${result.paymentId}`);
                    clearPaymentForm();
                } else {
                    showError('paymentResult', `Failed to create payment: ${response.status}`);
                }
            } catch (error) {
                showError('paymentResult', `Error: ${error.message}`);
            }
        }

        async function getAllPayments() {
            showLoading('paymentResult');
            try {
                const response = await fetch(`${API_BASE}/payments`);
                const payments = await response.json();
                
                if (payments.length === 0) {
                    showSuccess('paymentResult', 'No payments found. Create some payments first!');
                    return;
                }

                let html = '<h3>üí≥ All Payments</h3><table><tr><th>ID</th><th>Amount</th><th>Date</th><th>Loan ID</th></tr>';
                payments.forEach(payment => {
                    html += `<tr>
                        <td>${payment.paymentId}</td>
                        <td>$${payment.amount.toLocaleString()}</td>
                        <td>${payment.paymentDate}</td>
                        <td>${payment.loan.loanId}</td>
                    </tr>`;
                });
                html += '</table>';
                document.getElementById('paymentResult').innerHTML = html;
            } catch (error) {
                showError('paymentResult', `Error: ${error.message}`);
            }
        }

        function clearPaymentForm() {
            document.getElementById('paymentAmount').value = '';
            document.getElementById('paymentDate').value = '';
            document.getElementById('paymentLoanId').value = '';
        }

        // Search Functions
        async function searchByEmail() {
            const email = document.getElementById('searchEmail').value;
            if (!email) {
                showError('searchResult', 'Please enter an email to search!');
                return;
            }
            
            showLoading('searchResult');
            try {
                const response = await fetch(`${API_BASE}/customers/email/${email}`);
                if (response.ok) {
                    const result = await response.text();
                    document.getElementById('searchResult').innerHTML = 
                        `<div class="success"><h3>üîç Search Result by Email</h3><pre>${result}</pre></div>`;
                } else {
                    showError('searchResult', 'Customer not found with this email');
                }
            } catch (error) {
                showError('searchResult', `Error: ${error.message}`);
            }
        }

        async function searchByCredit() {
            const credit = document.getElementById('searchCredit').value;
            if (!credit) {
                showError('searchResult', 'Please enter minimum credit score!');
                return;
            }
            
            showLoading('searchResult');
            try {
                const response = await fetch(`${API_BASE}/customers/creditScore/${credit}`);
                if (response.ok) {
                    const customers = await response.json();
                    if (customers.length === 0) {
                        showSuccess('searchResult', `No customers found with credit score >= ${credit}`);
                        return;
                    }
                    
                    let html = `<h3>üîç Customers with Credit Score >= ${credit}</h3><table><tr><th>ID</th><th>Name</th><th>Email</th><th>Credit Score</th></tr>`;
                    customers.forEach(customer => {
                        html += `<tr>
                            <td>${customer.customerId}</td>
                            <td>${customer.customerName}</td>
                            <td>${customer.email}</td>
                            <td>${customer.creditScore}</td>
                        </tr>`;
                    });
                    html += '</table>';
                    document.getElementById('searchResult').innerHTML = html;
                } else {
                    showError('searchResult', 'No customers found with specified credit score');
                }
            } catch (error) {
                showError('searchResult', `Error: ${error.message}`);
            }
        }

        async function searchByStatus() {
            const status = document.getElementById('searchStatus').value;
            if (!status) {
                showError('searchResult', 'Please select a status to search!');
                return;
            }
            
            showLoading('searchResult');
            try {
                const response = await fetch(`${API_BASE}/loans/status/${status}`);
                if (response.ok) {
                    const loans = await response.json();
                    if (loans.length === 0) {
                        showSuccess('searchResult', `No loans found with status: ${status}`);
                        return;
                    }
                    
                    let html = `<h3>üîç Loans with Status: ${status}</h3><table><tr><th>ID</th><th>Amount</th><th>Status</th><th>Customer</th><th>Loan Type</th></tr>`;
                    loans.forEach(loan => {
                        html += `<tr>
                            <td>${loan.loanId}</td>
                            <td>$${loan.loanAmount.toLocaleString()}</td>
                            <td>${loan.status}</td>
                            <td>${loan.customer.customerName}</td>
                            <td>${loan.loanType.typeName}</td>
                        </tr>`;
                    });
                    html += '</table>';
                    document.getElementById('searchResult').innerHTML = html;
                } else {
                    showError('searchResult', `No loans found with status: ${status}`);
                }
            } catch (error) {
                showError('searchResult', `Error: ${error.message}`);
            }
        }

        async function getPaginatedCustomers() {
            const page = parseInt(document.getElementById('pageNumber').value) || 0;
            const size = parseInt(document.getElementById('pageSize').value) || 5;
            
            showLoading('searchResult');
            try {
                const response = await fetch(`${API_BASE}/customers/page/${page}/${size}`);
                const result = await response.json();
                
                let html = `<h3>üìÑ Paginated Customers (Page ${page + 1})</h3>`;
                html += `<p><strong>Total Elements:</strong> ${result.totalElements} | <strong>Total Pages:</strong> ${result.totalPages} | <strong>Current Page:</strong> ${result.number + 1}</p>`;
                
                if (result.content.length === 0) {
                    html += '<p>No customers found on this page.</p>';
                } else {
                    html += '<table><tr><th>ID</th><th>Name</th><th>Email</th><th>Credit Score</th></tr>';
                    result.content.forEach(customer => {
                        html += `<tr>
                            <td>${customer.customerId}</td>
                            <td>${customer.customerName}</td>
                            <td>${customer.email}</td>
                            <td>${customer.creditScore}</td>
                        </tr>`;
                    });
                    html += '</table>';
                }
                
                document.getElementById('searchResult').innerHTML = html;
            } catch (error) {
                showError('searchResult', `Error: ${error.message}`);
            }
        }

        // System Functions
        async function testConnection() {
            showLoading('statusResult');
            try {
                const response = await fetch(`${API_BASE}/customers`);
                if (response.ok) {
                    showSuccess('statusResult', 'API Connection Successful! Backend is running properly.');
                } else {
                    showError('statusResult', `API Connection Failed: ${response.status}`);
                }
            } catch (error) {
                showError('statusResult', `Connection Error: ${error.message}. Make sure your Spring Boot application is running.`);
            }
        }

        function clearAllResults() {
            const resultElements = ['customerResult', 'loanTypeResult', 'loanResult', 'paymentResult', 'searchResult', 'statusResult'];
            resultElements.forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            showSuccess('statusResult', 'All results cleared!');
        }

        // Initialize page
        window.onload = function() {
            // Set today's date as default for payment date
            document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
            
            // Test connection on page load
            testConnection();
        };
    </script>
</body>
</html>